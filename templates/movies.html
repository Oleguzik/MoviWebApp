{% extends 'base.html' %}

{% block title %}{{ user.name }}'s Movies - MoviWebApp{% endblock %}

{% block content %}
<div class="page-container">
	<div class="page-header">
		<h2>{{ user.name }}'s Favorite Movies</h2>
		<a href="{{ url_for('add_movie', user_id=user.id) }}" class="btn btn-success">+ Add Movie</a>
	</div>

	{% if movies %}
		<div class="search-bar">
			<form method="GET" action="{{ url_for('manage_movies', user_id=user.id) }}" class="search-form">
				<input 
					type="text" 
					name="q" 
					placeholder="Search by title or director..." 
					class="form-input"
					value="{{ query or '' }}"
				>
				<button type="submit" class="btn btn-primary">Search</button>
				{% if query %}
					<a href="{{ url_for('manage_movies', user_id=user.id) }}" class="btn btn-secondary">Clear</a>
				{% endif %}
			</form>
		</div>

		<div class="movies-grid">
			{% for movie in movies %}
				<div class="movie-card">
					<div class="movie-poster-wrapper">
						{% if movie.poster_url %}
							<img src="{{ movie.poster_url }}" alt="{{ movie.name }}" class="movie-poster" onerror="this.classList.add('poster-error')">
						{% else %}
							<div class="movie-poster placeholder">üìΩÔ∏è</div>
						{% endif %}
					</div>
					
					<div class="movie-info">
						<h3 class="movie-title">{{ movie.name }}</h3>
						<p class="director"><strong>Director:</strong> <span>{{ movie.director }}</span></p>
						<p class="year"><strong>Year:</strong> <span>{{ movie.year }}</span></p>
					</div>

					<div class="movie-actions">
						<a href="{{ url_for('update_movie', user_id=user.id, movie_id=movie.id) }}" class="btn btn-secondary btn-sm">Edit</a>
						<form method="POST" action="{{ url_for('delete_movie_route', user_id=user.id, movie_id=movie.id) }}" class="delete-form">
							<button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Delete this movie?')">Delete</button>
						</form>
					</div>
				</div>
			{% endfor %}
		</div>

		<p class="result-count">Showing {{ movies|length }} movie{{ 's' if movies|length != 1 else '' }}</p>
	{% else %}
		<div class="empty-state">
			{% if query %}
				<p>No movies found matching "{{ query }}"</p>
				<a href="{{ url_for('manage_movies', user_id=user.id) }}" class="btn btn-secondary">Clear Search</a>
			{% else %}
				<p>No movies added yet. Start by adding your first favorite!</p>
			{% endif %}
			<a href="{{ url_for('add_movie', user_id=user.id) }}" class="btn btn-success">Add Movie</a>
		</div>
	{% endif %}
</div>

<style>
	.movie-poster-wrapper {
		position: relative;
		overflow: hidden;
		border-radius: 8px 8px 0 0;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		min-height: 300px;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.movie-poster {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.3s ease, filter 0.3s ease;
		display: block;
	}

	.movie-card:hover .movie-poster {
		transform: scale(1.05);
		filter: brightness(1.1);
	}

	.movie-poster.placeholder {
		font-size: 60px;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		color: white;
	}

	.movie-poster.poster-error {
		background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
		font-size: 40px;
		color: white;
	}

	.movie-title {
		margin: 0;
		font-size: 1.1em;
		font-weight: 600;
		color: #2c3e50;
		line-height: 1.4;
	}

	.movie-info p {
		margin: 6px 0;
		font-size: 0.9em;
		color: #555;
	}

	.movie-info p span {
		color: #2c3e50;
		font-weight: 500;
	}
</style>
{% endblock %}